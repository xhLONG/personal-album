import{d as O,b as ue,w as H,_ as I,a as h,e as y,f as T,v as F,g as $,n as L,h as me,i as Y,o as ee,j as C,t as A,k as N,F as te,l as ne,m as X,r as M,p as fe,q as he,c as ge,s as ye,u as Z}from"./index-b8effe48.js";let b=2;const x=8,we=(e,l)=>{const n=[];let{offsetWidth:t}=e.listEl.parentNode;t>1e3&&(b=3),t-=x*(b-1);const i=JSON.parse(JSON.stringify(l));for(let c=0;c<i.length;c++){let r=c%b;const a=i[c],d=t/b/a.width;a.w=t/b,a.h=a.height*d,a.left=r*(t/b+x),a.top=n[r]+x||0,isNaN(n[r])?n[r]=a.h:(r=n.indexOf(Math.min(...n)),a.left=r*(t/b+x),a.top=n[r]+x||0,n[r]=a.h+n[r]+x)}e.list.length<=0&&(e.list=i);for(let c=0;c<e.list.length;c++)e.list[c].left=i[c].left,e.list[c].top=i[c].top,e.list[c].w=i[c].w,e.list[c].h=i[c].h,e.list[c].m=0;e.listHeight=Math.max(...n)},z=8;let ae=0;const ve=async(e,l)=>{ae=e.listEl.parentNode.offsetWidth;let n=[];const t=JSON.parse(JSON.stringify(l));n=await _e(t),e.list.length<=0&&(e.list=n);for(let i=0;i<e.list.length;i++)e.list[i].w=n[i].w,e.list[i].h=n[i].h,e.list[i].m=n[i].m,e.list[i].top=n[i].top};async function _e(e){const l=document.body.clientHeight/2,n=[];let t=0;function i(a){return new Promise(d=>{const s=e.shift();if(!s){d({height:c(a),list:a});return}a.push(s);const p=c(a);p>l?d(i(a)):(t++,d({height:p,top:t*p+z,list:a}))})}function c(a){let d=0;for(const s of a){const{width:p,height:f}=s;d+=p/f}return(ae-z*(a.length-1))/d}async function r(){const{list:a,height:d,top:s}=await i([e.shift()]);n.push(a.map((p,f)=>(p.w=p.width/p.height*d,p.h=d,p.m=f?`0 0 ${z}px ${z}px`:`0 0 ${z}px 0`,p.top=s,p))),e.length>0&&await r()}return await r(),n.flat()}const be=O({name:"Image",props:{src:{},data:{}},setup(e){const l=ue(!0),n=()=>{l.value=!1};return H(()=>e.src,()=>{l.value=!0}),{loading:l,loadDone:n}}}),$e={class:"img"},je=["src","raw","date"];function Se(e,l,n,t,i,c){return h(),y("div",$e,[T($("img",{src:e.src,raw:e.data.url,date:e.data.datetime,onLoad:l[0]||(l[0]=(...r)=>e.loadDone&&e.loadDone(...r))},null,40,je),[[F,!e.loading]]),e.loading?(h(),y("div",{key:0,class:"color",style:L({background:e.data.color})},null,4)):me("",!0)])}const xe=I(be,[["render",Se],["__scopeId","data-v-558a3aa0"]]);const Ie=O({name:"ImgList",components:{MyImage:xe},props:{data:{default:()=>[]}},setup(e,l){const n=Y({listEl:null,list:[],listHeight:0,type:0,currentDate:""});ee(async()=>{await C(),await t(e.data),n.currentDate=n.list[0].dateStr,document.body.addEventListener("scroll",()=>{const s=document.documentElement.scrollTop||document.body.scrollTop,p=n.list.findIndex(f=>f.top>=s);n.currentDate=n.list[p].dateStr})}),H(e.data,async s=>{t(s)}),window.onresize=function(){t(e.data)};async function t(s){const p={0:i,1:c};s=s||e.data,await p[n.type](s),d()}async function i(s){await we(n,s)}async function c(s){await ve(n,s)}const r=(s,p)=>{l.emit("change",{e:s,imgData:p})},a=()=>{n.type=n.type===0?1:0,t()};function d(){const s=new IntersectionObserver(p=>{p.forEach(f=>{if(f.isIntersecting){const j=+f.target.getAttribute("index");n.list[j].show=n.list[j].thumb,s.unobserve(f.target)}})});document.querySelectorAll(".img-box").forEach(p=>s.observe(p))}return{...A(n),change:r,changeType:a}}}),Ee={class:"datetime"},ze=["index"];function Ce(e,l,n,t,i,c){const r=M("MyImage");return h(),y("div",{ref:"listEl",class:"list",style:L({height:e.type===0?`${e.listHeight}px`:""})},[$("div",Ee,N(e.currentDate),1),$("div",{class:"button",onClick:l[0]||(l[0]=(...a)=>e.changeType&&e.changeType(...a))},"切换样式"),(h(!0),y(te,null,ne(e.list,(a,d)=>(h(),y("div",{key:`img${d}`,class:"img-box",style:L({position:e.type===0?"absolute":"",width:`${a.w}px`,height:`${a.h}px`,margin:a.m,left:`${a.left}px`,top:`${a.top}px`}),index:d},[X(r,{src:a.show,data:a,onClick:s=>e.change(s,a)},null,8,["src","data","onClick"])],12,ze))),128))],4)}const Le=I(Ie,[["render",Ce],["__scopeId","data-v-81474ed3"]]),Me=(e,l)=>{const n=new Image;n.src=e,n.onload=function(){l()}};const Oe=O({props:{modelValue:{default:!1}},setup(e,l){const n=Y({show:!1});H(()=>e.modelValue,i=>{i!==n.show&&(n.show=i),document.querySelector("body").style.overflow=i?"hidden":""});const t=()=>{l.emit("update:modelValue",!1),document.querySelector("body").style.overflow=""};return{...A(n),close:t}}});function ke(e,l,n,t,i,c){return T((h(),y("div",{onClick:l[0]||(l[0]=(...r)=>e.close&&e.close(...r)),class:he(["modal"])},[fe(e.$slots,"default",{},void 0,!0)],512)),[[F,e.show]])}const Be=I(Oe,[["render",ke],["__scopeId","data-v-901b7a7f"]]);const De={},Ne={class:"loading"};function Te(e,l){return h(),y("div",Ne)}const Fe=I(De,[["render",Te],["__scopeId","data-v-d8563542"]]);const Xe=O({name:"Preview",components:{Modal:Be,Loading:Fe},props:{},setup(e,l){const n=/Mobi|Android|iPhone/i.test(navigator.userAgent),t=Y({show:!1,wrap:null,img:null,scale:1,style:{},left:0,top:0,offset:{left:0,top:0},origin:"center",delay:`${n?0:.3}s`,details:[],isLoading:!1,size:0});let i={offset:{},origin:"center",scale:1},c={},r={x:0,y:0},a=!1,d=null;const s=new Map;let p=0,f=1,j={x:0,y:0};const{innerWidth:W,innerHeight:P}=window;ee(async()=>{await C(),window.addEventListener("pointerdown",o=>{o.preventDefault(),s.set(o.pointerId,o),a=!0,r={x:o.clientX,y:o.clientY},s.size===2&&(p=K(),f=t.scale)}),window.addEventListener("pointerup",o=>{if(s.delete(o.pointerId),s.size<=0)a=!1;else{const u=Array.from(s);r={x:u[0][1].clientX,y:u[0][1].clientY}}setTimeout(()=>{d=!1},300),n||(t.delay="0.3s")}),window.addEventListener("pointermove",o=>{if(a)if(d=r.x-o.clientX,s.size<2)t.delay="0s",t.offset={left:t.offset.left+(o.clientX-r.x),top:t.offset.top+(o.clientY-r.y)},r={x:o.clientX,y:o.clientY};else{s.set(o.pointerId,o);const u=K()/p;t.scale=u*f,q()}}),window.addEventListener("pointercancel",o=>{s.clear()})});function q(o=0,u=0){const m=Array.from(s);if(m.length===2){const w=m[0][1],E=m[1][1];o=(w.offsetX+E.offsetX)/2,u=(w.offsetY+E.offsetY)/2}t.origin=`${o}px ${u}px`;const v=t.offset.left+(t.scale-1)*(o-j.x),_=t.offset.top+(t.scale-1)*(u-j.y);j={x:o,y:u},t.offset={left:v,top:_}}const J=o=>{t.origin=`${o.offsetX}px ${o.offsetY}px`,o.deltaY&&(o.preventDefault(),o.deltaY<0?(t.scale+=.1,console.log("放大...")):o.deltaY>0&&(t.scale>=.2&&(t.scale-=.1),console.log("缩小...")),q(o.offsetX,o.offsetY))};let S=null,g=null;const oe=async({e:o,imgData:u})=>{ie(),g=o.target,S=g.cloneNode(!0);const m=u.exif||[];t.details=m.concat([{name:"摄于",value:g.getAttribute("date")}]),t.size=u.size,g.style.opacity=0,S.style.width="100%";const{top:v,left:_}=g.getBoundingClientRect(),{offsetWidth:w,offsetHeight:E,naturalWidth:Je,naturalHeight:Ke}=g;c={top:v,left:_,width:w};const U={x:w/2+_,y:E/2+v},G={x:W/2,y:P/2},B={left:G.x-U.x+_,top:G.y-U.y+v},D={left:(R()-1)*w/2,top:(R()-1)*E/2};t.wrap.appendChild(S),t.style={top:`${v}px`,left:`${_}px`,width:`${w}px`},t.show=!0,t.delay=".3s",await C(),setTimeout(async()=>{ce(),await C(),setTimeout(()=>{const Q=R();t.offset={left:B.left-_-D.left,top:B.top-v-D.top},t.style={top:`${v}px`,left:`${_}px`,width:`${w*Q}px`},setTimeout(()=>{t.delay="0s",t.offset={left:B.left-D.left,top:B.top-D.top},t.style={top:"0px",left:"0px",width:`${w*Q}px`},le()},300)},n?10:200)},10)};function se(){t.isLoading=!0,Me(g.getAttribute("raw"),async()=>{await C(),S.src=g.getAttribute("raw"),t.isLoading=!1,t.size=0})}function R(){const{offsetWidth:o,offsetHeight:u}=g;let m=0;return m=W/o,u*m>P-80&&(m=(P-80)/u),m}function ie(){t.scale=1,t.offset={left:0,top:0},t.origin="center",t.details=[]}function le(){i={offset:t.offset,origin:t.origin,scale:t.scale}}H(()=>t.show,o=>{o===!1&&(g.style.opacity=1,S&&S.remove(),pe())});let V=null,k=0;const re=()=>{if(V&&clearTimeout(V),!k)k=new Date().getTime();else{de(),k=0;return}V=setTimeout(()=>{if(s.size<2)if(k=0,d)d=!1;else{const{top:o,left:u,width:m}=c;t.delay=".3s",t.offset={left:u,top:o},t.style={width:`${m}px`},setTimeout(()=>{t.show=!1},300)}},280)};function de(){if(t.scale!==i.scale)for(const u in i)Object.prototype.hasOwnProperty.call(i,u)&&(t[u]=i[u]);else t.scale=t.scale+2}function ce(){t.wrap.addEventListener("mousewheel",J,{passive:!1})}function pe(){t.wrap.removeEventListener("mousewheel",J)}function K(){const o=Array.from(s);if(o.length<2)return 0;const u=o[0][1],m=o[1][1];return Math.hypot(m.x-u.x,m.y-u.y)}return{...A(t),open:oe,tap:re,showRaw:se}}}),He={class:"info"},Ye={class:"download"};function Ae(e,l,n,t,i,c){const r=M("Loading"),a=M("Modal");return h(),ge(a,{modelValue:e.show,"onUpdate:modelValue":l[2]||(l[2]=d=>e.show=d),style:L({"--delay_time":e.delay})},{default:ye(()=>[$("div",{ref:"wrap",style:L({...e.style,transformOrigin:e.origin,transform:`translate(${e.offset.left}px, ${e.offset.top}px) scale(${e.scale},${e.scale})`}),class:"wrap",onClick:l[0]||(l[0]=Z((...d)=>e.tap&&e.tap(...d),["stop"]))},null,4),$("div",He,[(h(!0),y(te,null,ne(e.details,(d,s)=>(h(),y("div",{key:`d${s}`},N(d.name)+": "+N(d.value),1))),128))]),T(X(r,null,null,512),[[F,e.isLoading]]),T($("div",Ye,[$("span",{class:"btn",onClick:l[1]||(l[1]=Z((...d)=>e.showRaw&&e.showRaw(...d),["stop"]))},"查看原图 ("+N(e.size)+")",1)],512),[[F,e.size]])]),_:1},8,["modelValue","style"])}const Pe=I(Xe,[["render",Ae],["__scopeId","data-v-555165b4"]]),Re=[{url:"1562936332000.jpeg",datetime:"2019-07-12 20:58:52",thumb:"thumb-1562936332000.jpeg",width:4e3,height:3e3,exif:[{name:"器材",value:"Redmi Note 7 Pro PXL "},{name:"焦距",value:"4.74mm"},{name:"参数",value:"F1.79, 1/13s, ISO105"}],orientation:1,type:"jpg",stamp:1562965132,year:"2019",month:"2019-07",date:"2019-07-12",dateStr:"2019年07月12日",color:"#2e1224",size:"3.34MB"},{url:"1563196703000.jpeg",datetime:"2019-07-15 21:18:23",thumb:"thumb-1563196703000.jpeg",exif:[{name:"器材",value:"NEX-5R"},{name:"焦距",value:"34mm"},{name:"参数",value:"F5, 1/1s, ISO100"}],height:2160,width:3251,type:"jpg",stamp:1563225503,year:"2019",month:"2019-07",date:"2019-07-15",dateStr:"2019年07月15日",color:"#6c7479",size:"784.2KB"},{url:"1563694069000.jpeg",datetime:"2019-07-21 15:27:49",thumb:"thumb-1563694069000.jpeg",exif:[{name:"器材",value:"Canon EOS 60D"},{name:"焦距",value:"50mm"},{name:"参数",value:"F3.2, 1/80s, ISO100"}],height:4150,width:2767,type:"jpg",stamp:1563722869,year:"2019",month:"2019-07",date:"2019-07-21",dateStr:"2019年07月21日",color:"#b59d8f",size:"3.92MB"},{url:"1563694128000.jpeg",datetime:"2019-07-21 15:28:48",thumb:"thumb-1563694128000.jpeg",exif:[{name:"器材",value:"Canon EOS 60D"},{name:"焦距",value:"50mm"},{name:"参数",value:"F2, 1/125s, ISO100"}],height:3223,width:4834,type:"jpg",stamp:1563722928,year:"2019",month:"2019-07",date:"2019-07-21",dateStr:"2019年07月21日",color:"#544446",size:"5.51MB"},{url:"1563696663000.jpeg",datetime:"2019-07-21 16:11:03",thumb:"thumb-1563696663000.jpeg",exif:[{name:"器材",value:"Canon EOS 60D"},{name:"焦距",value:"50mm"},{name:"参数",value:"F1.8, 1/100s, ISO400"}],height:5184,width:3456,type:"jpg",stamp:1563725463,year:"2019",month:"2019-07",date:"2019-07-21",dateStr:"2019年07月21日",color:"#2a3135",size:"6.34MB"},{url:"1563696730000.jpeg",datetime:"2019-07-21 16:12:10",thumb:"thumb-1563696730000.jpeg",exif:[{name:"器材",value:"Canon EOS 60D"},{name:"焦距",value:"50mm"},{name:"参数",value:"F2, 1/125s, ISO160"}],height:4864,width:3243,type:"jpg",stamp:1563725530,year:"2019",month:"2019-07",date:"2019-07-21",dateStr:"2019年07月21日",color:"#44403e",size:"5.97MB"},{url:"1563702621000.jpeg",datetime:"2019-07-21 17:50:21",thumb:"thumb-1563702621000.jpeg",exif:[{name:"器材",value:"Canon EOS 60D\0"},{name:"焦距",value:"50mm"},{name:"参数",value:"F3.5, 1/125s, ISO100"}],height:5097,width:3398,type:"jpg",stamp:1563731421,year:"2019",month:"2019-07",date:"2019-07-21",dateStr:"2019年07月21日",color:"#374532",size:"4.69MB"},{url:"1563702624000.jpeg",datetime:"2023-03-18 07:29:46",thumb:"thumb-1563702624000.jpeg",height:4638,width:3092,type:"jpg",stamp:1679124586,year:"2023",month:"2023-03",date:"2023-03-18",dateStr:"2023年03月18日",color:"#667a85",size:"8.14MB"},{url:"1564914554000.jpeg",datetime:"2019-08-04 18:29:14",thumb:"thumb-1564914554000.jpeg",exif:[{name:"器材",value:"NEX-5R"},{name:"参数",value:"1/800s, ISO100"}],height:2160,width:3251,type:"jpg",stamp:1564943354,year:"2019",month:"2019-08",date:"2019-08-04",dateStr:"2019年08月04日",color:"#6b8ca9",size:"954.8KB"},{url:"1567660069000.jpeg",datetime:"2019-09-05 13:07:49",thumb:"thumb-1567660069000.jpeg",exif:[{name:"器材",value:"NEX-5R"},{name:"参数",value:"1/200s, ISO100"}],height:2160,width:3844,type:"jpg",stamp:1567688869,year:"2019",month:"2019-09",date:"2019-09-05",dateStr:"2019年09月05日",color:"#6f92ac",size:"1.61MB"},{url:"1567953227000.jpeg",datetime:"2023-03-18 07:29:46",thumb:"thumb-1567953227000.jpeg",exif:[],height:2160,width:1214,type:"jpg",stamp:1679124586,year:"2023",month:"2023-03",date:"2023-03-18",dateStr:"2023年03月18日",color:"#2d3b45",size:"1.41MB"},{url:"1568457043000.jpeg",datetime:"2019-09-14 18:30:43",thumb:"thumb-1568457043000.jpeg",exif:[{name:"器材",value:"ILCE-6300"},{name:"焦距",value:"50mm"},{name:"参数",value:"F2.2, 1/1000s, ISO100"}],height:3024,width:2160,type:"jpg",stamp:1568485843,year:"2019",month:"2019-09",date:"2019-09-14",dateStr:"2019年09月14日",color:"#24303a",size:"821.5KB"},{url:"1568457046000.jpeg",datetime:"2023-03-18 07:29:46",thumb:"thumb-1568457046000.jpeg",height:3494,width:5241,type:"jpg",stamp:1679124586,year:"2023",month:"2023-03",date:"2023-03-18",dateStr:"2023年03月18日",color:"#a1a7b0",size:"5.01MB"},{url:"1568457047000.jpeg",datetime:"2023-03-18 07:29:46",thumb:"thumb-1568457047000.jpeg",height:4763,width:3175,type:"jpg",stamp:1679124586,year:"2023",month:"2023-03",date:"2023-03-18",dateStr:"2023年03月18日",color:"#b09d8f",size:"7.03MB"},{url:"1568458065000.jpeg",datetime:"2019-09-14 18:47:45",thumb:"thumb-1568458065000.jpeg",exif:[{name:"器材",value:"ILCE-6300"},{name:"焦距",value:"35mm"},{name:"参数",value:"F2.2, 1/250s, ISO100"}],height:3240,width:2160,type:"jpg",stamp:1568486865,year:"2019",month:"2019-09",date:"2019-09-14",dateStr:"2019年09月14日",color:"#cabbba",size:"869.1KB"},{url:"1568458764000.jpeg",datetime:"2019-09-14 18:59:24",thumb:"thumb-1568458764000.jpeg",exif:[{name:"器材",value:"ILCE-6300"},{name:"焦距",value:"35mm"},{name:"参数",value:"F2, 1/250s, ISO100"}],height:2160,width:3240,type:"jpg",stamp:1568487564,year:"2019",month:"2019-09",date:"2019-09-14",dateStr:"2019年09月14日",color:"#3a5551",size:"1.43MB"}];const Ve=O({components:{preview:Pe,imgList:Le},setup(){const e=Y({preview:null,json:Re.sort(function(n,t){return t.stamp-n.stamp})}),l=n=>{e.preview.open(n)};return{...A(e),checkImage:l}}}),We={class:"home"};function qe(e,l,n,t,i,c){const r=M("img-list"),a=M("preview");return h(),y("div",We,[X(r,{onChange:e.checkImage,data:e.json},null,8,["onChange","data"]),X(a,{ref:"preview"},null,512)])}const Ge=I(Ve,[["render",qe],["__scopeId","data-v-1c46b2bd"]]);export{Ge as default};
